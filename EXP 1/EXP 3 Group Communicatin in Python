# server

import socket

localIP = "127.0.0.1"
localPort = 20001
bufferSize = 1024

# Create a datagram socket
UDPServerSocket = socket.socket(family=socket.AF_INET, type=socket.SOCK_DGRAM)

# Bind to address and IP
UDPServerSocket.bind((localIP, localPort))
print("UDP server up and listening")

# Listen for incoming datagrams
while(True):
    bytesAddressPair = UDPServerSocket.recvfrom(bufferSize)
    message = bytesAddressPair[0]
    address = bytesAddressPair[1]
    
    m = message.decode()
    clientMsg = "Message from Client: " + m[len(m)-1:] + ": " + m[0:len(m)-1]
    clientIP = "Client IP Address: {}".format(address)

    print(clientMsg)

    # Take input from server to send back to client
    msgFromServer = input("Enter your message for client " + m[len(m)-1:] + ": ")
    bytesToSend = str.encode(msgFromServer)

    # Sending a reply to client
    UDPServerSocket.sendto(bytesToSend, address)


# client 1 

import socket
import time

while True:
    msgFromClient = input("Enter your message :")  # User input for message
    bytesToSend = str.encode(msgFromClient + "1")  # Append "1" to message to identify client
    serverAddressPort = ("127.0.0.1", 20001)  # Server IP and port
    bufferSize = 1024  # Buffer size for receiving server response

    # Create a UDP socket (client-side)
    UDPClientSocket = socket.socket(family=socket.AF_INET, type=socket.SOCK_DGRAM)

    # Send the message to the server
    UDPClientSocket.sendto(bytesToSend, serverAddressPort)
    msgFromServer = UDPClientSocket.recvfrom(bufferSize)  # Receive server's reply
    msg = "Message from Server :{}".format(msgFromServer[0].decode())

    print(msg)


# client 2

import socket
import time

while True:
    msgFromClient = input("Enter your message :")  # User input for message
    bytesToSend = str.encode(msgFromClient + "2")  # Append "2" to message to identify client
    serverAddressPort = ("127.0.0.1", 20001)  # Server IP and port
    bufferSize = 1024  # Buffer size for receiving server response

    # Create a UDP socket (client-side)
    UDPClientSocket = socket.socket(family=socket.AF_INET, type=socket.SOCK_DGRAM)

    # Send the message to the server
    UDPClientSocket.sendto(bytesToSend, serverAddressPort)
    msgFromServer = UDPClientSocket.recvfrom(bufferSize)  # Receive server's reply
    msg = "Message from Server :{}".format(msgFromServer[0].decode())

    print(msg)
